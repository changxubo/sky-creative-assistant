.image_scan:
  stage: image_scan
  image: cnharbor.amway.com.cn/lightai/tools:241101
  script:
    - echo "image scan success"
    #- podman login -u ${APP_HARBOR_USER} -p ${APP_HARBOR_PASSWORD} ${DOCKER_REGISTRY}
    #- podman pull ${DOCKER_REGISTRY}/${DOCKER_PROJECT}/${IMAGE_NAME}:${CI_BUILD_REF_NAME}-${CI_COMMIT_SHORT_SHA}
    #- twistcli images scan --address ${TWISTCLI_ADDRESS} --user jenkins --password ${TWISTCLI_PASSWORD} ${DOCKER_REGISTRY}/${DOCKER_PROJECT}/${IMAGE_NAME}:${CI_BUILD_REF_NAME}-${CI_COMMIT_SHORT_SHA}
    #- curl -k -u jenkins:${TWISTCLI_PASSWORD} -H "Content-Type:application/json" -X GET ${TWISTCLI_ADDRESS}/api/v1/scans/download?imageID=`podman images --no-trunc | grep ${CI_BUILD_REF_NAME}-${CI_COMMIT_SHORT_SHA} | awk '{print $3}' | awk -F ':' '{print $2}'` > twistlock_scans_${IMAGE_NAME}:${CI_BUILD_REF_NAME}-${CI_COMMIT_SHORT_SHA}.scv
    #- curl -v -u admin:Devops2019 -T twistlock_scans_${IMAGE_NAME}:${CI_BUILD_REF_NAME}-${CI_COMMIT_SHORT_SHA}.scv http://nexus-cn.intranet.local/repository/twistlock_scans_report
  